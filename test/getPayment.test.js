"use strict";
// test/getPayment.test.ts
Object.defineProperty(exports, "__esModule", { value: true });
const payments = require("../src/lib/payments");
const getPayment_1 = require("../src/getPayment");
describe('getPayment handler', () => {
    afterEach(() => {
        jest.resetAllMocks();
    });
    it('returns 200 and the payment when found', async () => {
        const paymentId = '550e8400-e29b-41d4-a716-446655440000';
        const mockPayment = { id: paymentId, currency: 'AUD', amount: 2000 };
        const getSpy = jest
            .spyOn(payments, 'getPayment')
            .mockResolvedValueOnce(mockPayment);
        const event = {
            pathParameters: { id: paymentId },
        };
        const result = await (0, getPayment_1.handler)(event);
        expect(getSpy).toHaveBeenCalledTimes(1);
        expect(getSpy).toHaveBeenCalledWith(paymentId);
        expect(result.statusCode).toBe(200);
        expect(JSON.parse(result.body)).toEqual(mockPayment);
    });
    it('returns 400 when pathParameters or id is missing', async () => {
        const event1 = {};
        const res1 = await (0, getPayment_1.handler)(event1);
        expect(res1.statusCode).toBe(400);
        expect(JSON.parse(res1.body)).toEqual({ error: 'Missing payment ID parameter' });
        const event2 = { pathParameters: {} };
        const res2 = await (0, getPayment_1.handler)(event2);
        expect(res2.statusCode).toBe(400);
        expect(JSON.parse(res2.body)).toEqual({ error: 'Missing payment ID parameter' });
    });
    it('returns 404 when payment is not found', async () => {
        const paymentId = 'nonexistent-id';
        const getSpy = jest
            .spyOn(payments, 'getPayment')
            .mockResolvedValueOnce(null);
        const event = {
            pathParameters: { id: paymentId },
        };
        const result = await (0, getPayment_1.handler)(event);
        expect(getSpy).toHaveBeenCalledTimes(1);
        expect(getSpy).toHaveBeenCalledWith(paymentId);
        expect(result.statusCode).toBe(404);
        expect(JSON.parse(result.body)).toEqual({ error: 'Payment not found' });
    });
    it('returns 500 on unexpected exceptions', async () => {
        const paymentId = '550e8400-e29b-41d4-a716-446655440000';
        jest
            .spyOn(payments, 'getPayment')
            .mockRejectedValueOnce(new Error('boom'));
        const event = {
            pathParameters: { id: paymentId },
        };
        const result = await (0, getPayment_1.handler)(event);
        expect(result.statusCode).toBe(500);
        expect(JSON.parse(result.body)).toEqual({ error: 'Internal server error' });
    });
    it('handles edge-case IDs correctly', async () => {
        const edgeId = "ID_WITH_SPECIAL-._~!*'();:@&=+$,/?#[]";
        const mockPayment = { id: edgeId, currency: 'EUR', amount: 0 };
        const getSpy = jest
            .spyOn(payments, 'getPayment')
            .mockResolvedValueOnce(mockPayment);
        const event = {
            pathParameters: { id: edgeId },
        };
        const result = await (0, getPayment_1.handler)(event);
        expect(getSpy).toHaveBeenCalledTimes(1);
        expect(getSpy).toHaveBeenCalledWith(edgeId);
        expect(result.statusCode).toBe(200);
        expect(JSON.parse(result.body)).toEqual(mockPayment);
    });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZ2V0UGF5bWVudC50ZXN0LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiZ2V0UGF5bWVudC50ZXN0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSwwQkFBMEI7O0FBRTFCLGdEQUFnRDtBQUNoRCxrREFBNEM7QUFHNUMsUUFBUSxDQUFDLG9CQUFvQixFQUFFLEdBQUcsRUFBRTtJQUNsQyxTQUFTLENBQUMsR0FBRyxFQUFFO1FBQ2IsSUFBSSxDQUFDLGFBQWEsRUFBRSxDQUFDO0lBQ3ZCLENBQUMsQ0FBQyxDQUFDO0lBRUgsRUFBRSxDQUFDLHdDQUF3QyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQ3RELE1BQU0sU0FBUyxHQUFHLHNDQUFzQyxDQUFDO1FBQ3pELE1BQU0sV0FBVyxHQUFHLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxJQUFJLEVBQUUsQ0FBQztRQUNyRSxNQUFNLE1BQU0sR0FBRyxJQUFJO2FBQ2hCLEtBQUssQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDO2FBQzdCLHFCQUFxQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXRDLE1BQU0sS0FBSyxHQUFHO1lBQ1osY0FBYyxFQUFFLEVBQUUsRUFBRSxFQUFFLFNBQVMsRUFBRTtTQUNDLENBQUM7UUFFckMsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLG9CQUFPLEVBQUMsS0FBSyxDQUFDLENBQUM7UUFFcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxTQUFTLENBQUMsQ0FBQztRQUMvQyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMs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LGlDQUFpQyxFQUFFLEtBQUssSUFBSSxFQUFFO1FBQy9DLE1BQU0sTUFBTSxHQUFHLHVDQUF1QyxDQUFDO1FBQ3ZELE1BQU0sV0FBVyxHQUFHLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRSxRQUFRLEVBQUUsS0FBSyxFQUFFLE1BQU0sRUFBRSxDQUFDLEVBQUUsQ0FBQztRQUMvRCxNQUFNLE1BQU0sR0FBRyxJQUFJO2FBQ2hCLEtBQUssQ0FBQyxRQUFRLEVBQUUsWUFBWSxDQUFDO2FBQzdCLHFCQUFxQixDQUFDLFdBQVcsQ0FBQyxDQUFDO1FBRXRDLE1BQU0sS0FBSyxHQUFHO1lBQ1osY0FBYyxFQUFFLEVBQUUsRUFBRSxFQUFFLE1BQU0sRUFBRTtTQUNJLENBQUM7UUFFckMsTUFBTSxNQUFNLEdBQUcsTUFBTSxJQUFBLG9CQUFPLEVBQUMsS0FBSyxDQUFDLENBQUM7UUFFcEMsTUFBTSxDQUFDLE1BQU0sQ0FBQyxDQUFDLHFCQUFxQixDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ3hDLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQyxvQkFBb0IsQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUM1QyxNQUFNLENBQUMsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztRQUNwQyxNQUFNLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLENBQUMsQ0FBQyxPQUFPLENBQUMsV0FBVyxDQUFDLENBQUM7SUFDdkQsQ0FBQyxDQUFDLENBQUM7QUFDTCxDQUFDLENBQUMsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIi8vIHRlc3QvZ2V0UGF5bWVudC50ZXN0LnRzXG5cbmltcG9ydCAqIGFzIHBheW1lbnRzIGZyb20gJy4uL3NyYy9saWIvcGF5bWVudHMnO1xuaW1wb3J0IHsgaGFuZGxlciB9IGZyb20gJy4uL3NyYy9nZXRQYXltZW50JztcbmltcG9ydCB7IEFQSUdhdGV3YXlQcm94eUV2ZW50IH0gZnJvbSAnYXdzLWxhbWJkYSc7XG5cbmRlc2NyaWJlKCdnZXRQYXltZW50IGhhbmRsZXInLCAoKSA9PiB7XG4gIGFmdGVyRWFjaCgoKSA9PiB7XG4gICAgamVzdC5yZXNldEFsbE1vY2tzKCk7XG4gIH0pO1xuXG4gIGl0KCdyZXR1cm5zIDIwMCBhbmQgdGhlIHBheW1lbnQgd2hlbiBmb3VuZCcsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBwYXltZW50SWQgPSAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJztcbiAgICBjb25zdCBtb2NrUGF5bWVudCA9IHsgaWQ6IHBheW1lbnRJZCwgY3VycmVuY3k6ICdBVUQnLCBhbW91bnQ6IDIwMDAgfTtcbiAgICBjb25zdCBnZXRTcHkgPSBqZXN0XG4gICAgICAuc3B5T24ocGF5bWVudHMsICdnZXRQYXltZW50JylcbiAgICAgIC5tb2NrUmVzb2x2ZWRWYWx1ZU9uY2UobW9ja1BheW1lbnQpO1xuXG4gICAgY29uc3QgZXZlbnQgPSB7XG4gICAgICBwYXRoUGFyYW1ldGVyczogeyBpZDogcGF5bWVudElkIH0sXG4gICAgfSBhcyB1bmtub3duIGFzIEFQSUdhdGV3YXlQcm94eUV2ZW50O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCk7XG5cbiAgICBleHBlY3QoZ2V0U3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KGdldFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgocGF5bWVudElkKTtcbiAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoMjAwKTtcbiAgICBleHBlY3QoSlNPTi5wYXJzZShyZXN1bHQuYm9keSkpLnRvRXF1YWwobW9ja1BheW1lbnQpO1xuICB9KTtcblxuICBpdCgncmV0dXJucyA0MDAgd2hlbiBwYXRoUGFyYW1ldGVycyBvciBpZCBpcyBtaXNzaW5nJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGV2ZW50MSA9IHt9IGFzIHVua25vd24gYXMgQVBJR2F0ZXdheVByb3h5RXZlbnQ7XG4gICAgY29uc3QgcmVzMSA9IGF3YWl0IGhhbmRsZXIoZXZlbnQxKTtcbiAgICBleHBlY3QocmVzMS5zdGF0dXNDb2RlKS50b0JlKDQwMCk7XG4gICAgZXhwZWN0KEpTT04ucGFyc2UocmVzMS5ib2R5KSkudG9FcXVhbCh7IGVycm9yOiAnTWlzc2luZyBwYXltZW50IElEIHBhcmFtZXRlcicgfSk7XG5cbiAgICBjb25zdCBldmVudDIgPSB7IHBhdGhQYXJhbWV0ZXJzOiB7fSB9IGFzIHVua25vd24gYXMgQVBJR2F0ZXdheVByb3h5RXZlbnQ7XG4gICAgY29uc3QgcmVzMiA9IGF3YWl0IGhhbmRsZXIoZXZlbnQyKTtcbiAgICBleHBlY3QocmVzMi5zdGF0dXNDb2RlKS50b0JlKDQwMCk7XG4gICAgZXhwZWN0KEpTT04ucGFyc2UocmVzMi5ib2R5KSkudG9FcXVhbCh7IGVycm9yOiAnTWlzc2luZyBwYXltZW50IElEIHBhcmFtZXRlcicgfSk7XG4gIH0pO1xuXG4gIGl0KCdyZXR1cm5zIDQwNCB3aGVuIHBheW1lbnQgaXMgbm90IGZvdW5kJywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IHBheW1lbnRJZCA9ICdub25leGlzdGVudC1pZCc7XG4gICAgY29uc3QgZ2V0U3B5ID0gamVzdFxuICAgICAgLnNweU9uKHBheW1lbnRzLCAnZ2V0UGF5bWVudCcpXG4gICAgICAubW9ja1Jlc29sdmVkVmFsdWVPbmNlKG51bGwpO1xuXG4gICAgY29uc3QgZXZlbnQgPSB7XG4gICAgICBwYXRoUGFyYW1ldGVyczogeyBpZDogcGF5bWVudElkIH0sXG4gICAgfSBhcyB1bmtub3duIGFzIEFQSUdhdGV3YXlQcm94eUV2ZW50O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCk7XG5cbiAgICBleHBlY3QoZ2V0U3B5KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgZXhwZWN0KGdldFNweSkudG9IYXZlQmVlbkNhbGxlZFdpdGgocGF5bWVudElkKTtcbiAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNDA0KTtcbiAgICBleHBlY3QoSlNPTi5wYXJzZShyZXN1bHQuYm9keSkpLnRvRXF1YWwoeyBlcnJvcjogJ1BheW1lbnQgbm90IGZvdW5kJyB9KTtcbiAgfSk7XG5cbiAgaXQoJ3JldHVybnMgNTAwIG9uIHVuZXhwZWN0ZWQgZXhjZXB0aW9ucycsIGFzeW5jICgpID0+IHtcbiAgICBjb25zdCBwYXltZW50SWQgPSAnNTUwZTg0MDAtZTI5Yi00MWQ0LWE3MTYtNDQ2NjU1NDQwMDAwJztcbiAgICBqZXN0XG4gICAgICAuc3B5T24ocGF5bWVudHMsICdnZXRQYXltZW50JylcbiAgICAgIC5tb2NrUmVqZWN0ZWRWYWx1ZU9uY2UobmV3IEVycm9yKCdib29tJykpO1xuXG4gICAgY29uc3QgZXZlbnQgPSB7XG4gICAgICBwYXRoUGFyYW1ldGVyczogeyBpZDogcGF5bWVudElkIH0sXG4gICAgfSBhcyB1bmtub3duIGFzIEFQSUdhdGV3YXlQcm94eUV2ZW50O1xuXG4gICAgY29uc3QgcmVzdWx0ID0gYXdhaXQgaGFuZGxlcihldmVudCk7XG5cbiAgICBleHBlY3QocmVzdWx0LnN0YXR1c0NvZGUpLnRvQmUoNTAwKTtcbiAgICBleHBlY3QoSlNPTi5wYXJzZShyZXN1bHQuYm9keSkpLnRvRXF1YWwoeyBlcnJvcjogJ0ludGVybmFsIHNlcnZlciBlcnJvcicgfSk7XG4gIH0pO1xuXG4gIGl0KCdoYW5kbGVzIGVkZ2UtY2FzZSBJRHMgY29ycmVjdGx5JywgYXN5bmMgKCkgPT4ge1xuICAgIGNvbnN0IGVkZ2VJZCA9IFwiSURfV0lUSF9TUEVDSUFMLS5ffiEqJygpOzpAJj0rJCwvPyNbXVwiO1xuICAgIGNvbnN0IG1vY2tQYXltZW50ID0geyBpZDogZWRnZUlkLCBjdXJyZW5jeTogJ0VVUicsIGFtb3VudDogMCB9O1xuICAgIGNvbnN0IGdldFNweSA9IGplc3RcbiAgICAgIC5zcHlPbihwYXltZW50cywgJ2dldFBheW1lbnQnKVxuICAgICAgLm1vY2tSZXNvbHZlZFZhbHVlT25jZShtb2NrUGF5bWVudCk7XG5cbiAgICBjb25zdCBldmVudCA9IHtcbiAgICAgIHBhdGhQYXJhbWV0ZXJzOiB7IGlkOiBlZGdlSWQgfSxcbiAgICB9IGFzIHVua25vd24gYXMgQVBJR2F0ZXdheVByb3h5RXZlbnQ7XG5cbiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBoYW5kbGVyKGV2ZW50KTtcblxuICAgIGV4cGVjdChnZXRTcHkpLnRvSGF2ZUJlZW5DYWxsZWRUaW1lcygxKTtcbiAgICBleHBlY3QoZ2V0U3B5KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChlZGdlSWQpO1xuICAgIGV4cGVjdChyZXN1bHQuc3RhdHVzQ29kZSkudG9CZSgyMDApO1xuICAgIGV4cGVjdChKU09OLnBhcnNlKHJlc3VsdC5ib2R5KSkudG9FcXVhbChtb2NrUGF5bWVudCk7XG4gIH0pO1xufSk7XG4iXX0=